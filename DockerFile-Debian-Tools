# =============================================================================
# DGX PENTEST ARSENAL - PURE EDITION (VERIFIED V17)
# Base: Debian 12 (Bookworm)
# =============================================================================
FROM debian:bookworm

LABEL maintainer="RedTeam-DGX-Verified"

# --- 1. CONFIGURATION ENVIRONNEMENT ---
ENV DEBIAN_FRONTEND=noninteractive \
    GOROOT=/usr/local/go \
    GOPATH=/root/go \
    PIPX_HOME=/opt/pipx \
    PIPX_BIN_DIR=/usr/local/bin \
    # Ajout des chemins au PATH
    PATH="/usr/local/go/bin:/root/go/bin:/usr/local/bin:/usr/bin:/bin:${PATH}" \
    LANG=C.UTF-8

# =============================================================================
# 2. DÃ‰PENDANCES SYSTÃˆME (APT)
# =============================================================================
RUN apt-get update && apt-get install -y --no-install-recommends \
    # Core
    build-essential curl wget git unzip zip jq tmux vim nano \
    software-properties-common ca-certificates gnupg lsb-release \
    # RÃ©seau & Analyse
    nmap masscan dnsutils iputils-ping net-tools whois proxychains4 tcpdump tshark \
    # DÃ©pendances Compilation (Python/Ruby/C)
    python3 python3-pip python3-venv python3-dev \
    ruby-full ruby-dev \
    libpcap-dev libssl-dev libffi-dev libxml2-dev libxslt1-dev zlib1g-dev \
    libfreetype6-dev libjpeg-dev liblcms2-dev libgmp-dev \
    # Hardware Utils
    pciutils lshw \
    && rm -rf /var/lib/apt/lists/*

# =============================================================================
# 3. GOLANG (Version 1.23.1 Stable)
# =============================================================================
RUN set -eux; \
    ARCH="amd64"; \
    GO_VERSION="1.23.1"; \
    echo "â¬‡ï¸ Downloading Go ${GO_VERSION}..." && \
    wget -q "https://go.dev/dl/go${GO_VERSION}.linux-${ARCH}.tar.gz" -O go.tar.gz && \
    tar -C /usr/local -xzf go.tar.gz && \
    rm go.tar.gz

# =============================================================================
# 4. ARSENAL GO (Liens VÃ©rifiÃ©s)
# =============================================================================
RUN echo "ðŸ› ï¸ Installing Go Tools..." && \
    # ProjectDiscovery (Derniers Chemins v2/v3 vÃ©rifiÃ©s)
    go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest && \
    go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest && \
    go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest && \
    go install -v github.com/projectdiscovery/katana/cmd/katana@latest && \
    go install -v github.com/projectdiscovery/naabu/v2/cmd/naabu@latest && \
    go install -v github.com/projectdiscovery/dnsx/cmd/dnsx@latest && \
    go install -v github.com/projectdiscovery/notify/cmd/notify@latest && \
    # Web Recon
    go install -v github.com/tomnomnom/gf@latest && \
    go install -v github.com/tomnomnom/qsreplace@latest && \
    go install -v github.com/tomnomnom/waybackurls@latest && \
    go install -v github.com/lc/gau/v2/cmd/gau@latest && \
    go install -v github.com/hakluke/hakrawler@latest && \
    go install -v github.com/hahwul/dalfox/v2@latest && \
    go install -v github.com/OJ/gobuster/v3@latest && \
    # Correction chemin Amass pour Ã©viter erreur de build
    go install -v github.com/owasp-amass/amass/v4/cmd/amass@latest && \
    # Infra / AD / Pivot
    go install -v github.com/ropnop/kerbrute@latest && \
    go install -v github.com/jpillora/chisel@latest && \
    go install -v github.com/nicocha30/ligolo-ng/cmd/proxy@latest && \
    go install -v github.com/nicocha30/ligolo-ng/cmd/agent@latest && \
    # Finalisation
    cp /root/go/bin/* /usr/local/bin/ && \
    ln -s /usr/local/bin/httpx /usr/local/bin/httpx-toolkit

# =============================================================================
# 5. PYTHON TOOLS (PIPX - Compatible Debian 12)
# =============================================================================
# On force l'install de pipx malgrÃ© la restriction "externally managed" de Debian
RUN python3 -m pip install --no-cache-dir --break-system-packages pipx && \
    python3 -m pipx ensurepath

# Outils Infra (Liens Git vÃ©rifiÃ©s)
RUN pipx install git+https://github.com/Pennyw0rth/NetExec.git --include-deps --force
RUN pipx install certipy-ad --force
RUN pipx install bloodhound --force
RUN pipx install mitm6 --force

# Outils Web (PyPI)
RUN pipx install sqlmap --force
RUN pipx install arjun --force
RUN pipx install dirsearch --force
RUN pipx install uro --force
RUN pipx install tldextract --force

# =============================================================================
# 6. OUTILS MANUELS & BINAIRES
# =============================================================================
WORKDIR /opt

# Findomain (Installation robuste via URL directe release)
# Note : Findomain change souvent ses liens, celui-ci est le gÃ©nÃ©rique pour Linux
RUN wget -q https://github.com/findomain/findomain/releases/latest/download/findomain-linux.zip && \
    unzip findomain-linux.zip && chmod +x findomain && \
    mv findomain /usr/local/bin/ && rm findomain-linux.zip

# Responder (Toujours Ã  jour sur le repo lgandx)
RUN git clone --depth 1 https://github.com/lgandx/Responder.git && \
    chmod +x /opt/Responder/Responder.py && \
    ln -sf /opt/Responder/Responder.py /usr/local/bin/responder

# Corsy (Scanner CORS) - Installation deps avec break-system-packages (Safe en Docker)
RUN git clone --depth 1 https://github.com/s0md3v/Corsy.git && \
    cd Corsy && \
    pip install -r requirements.txt --break-system-packages && \
    chmod +x corsy.py && \
    ln -sf /opt/Corsy/corsy.py /usr/local/bin/corsy

# Metasploit Framework (Script officiel Rapid7)
RUN curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && \
    chmod 755 msfinstall && ./msfinstall
# Gems additionnels utiles
RUN gem install wpscan evil-winrm --no-document

# =============================================================================
# 7. CONFIGURATIONS
# =============================================================================
WORKDIR /root

# GF Patterns (Indispensable pour gf sqli/xss)
RUN mkdir -p /root/.gf && \
    git clone --depth 1 https://github.com/1ndianl33t/Gf-Patterns /tmp/gf1 && \
    cp /tmp/gf1/*.json /root/.gf/ && rm -rf /tmp/gf1

# Nuclei Templates (Mise Ã  jour au build)
RUN nuclei -update-templates || echo "Nuclei update skipped"

# Nettoyage final pour gagner de la place
RUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# Banner
RUN echo 'echo "âš”ï¸ [DGX PURE ARSENAL] Debian 12 Ready. Happy Hacking."' >> /root/.bashrc

WORKDIR /app
CMD ["/bin/bash"]
